[{"name": "app.py", "content": "\"\"\"Web application with UI layout for configurator app.\"\"\"\n\nimport asyncio\nfrom datetime import date\nfrom shiny import App, render, reactive, ui\n\n# from shiny import App, reactive\n# from shiny.express import input, ui\nimport backend\n\nMOTOR_CHOICES = {\n    \"S\": {\n        \"fh2807\": \"Flashhobby 2807 1300KV\",\n        \"em2807\": \"Emax Eco II 2807 1300KV\",\n        \"tm2806\": \"T-Motor F90 2806.5 1300KV\",\n    },\n    \"M\": {\"bh2810\": \"Brotherhobby Avenger 2810 900KV\"},\n    \"L\": {\n        \"xc3110\": \"XING2 Cinelifter 3110 1250KV\",\n        \"bh3212\": \"BrotherHobby Special Edition V4 32.5 12 950KV\",\n    },\n}\n\nFRAME_CHOICES = {\n    \"S\": {\n        \"apex_hd\": \"Apex HD\",\n        \"source_one\": \"Source One\",\n        \"mark_4\": \"Mark 4\",\n    },\n    \"M\": {\n        \"apex_hd\": \"Apex HD\",\n        \"source_one\": \"Source One\",\n        \"mark_4\": \"Mark 4\",\n    },\n    \"L\": {\n        \"iflight_xl10\": \"iFlight Nazgul XL10 V6\",\n        \"axisflying_manta\": \"Axisflying MANTA10 Lite\",\n    },\n}\n# define UI layout\napp_ui = ui.page_fillable(\n    ui.card(\n        ui.card_header(\"FPV Drone Configurator\"),\n        ui.layout_sidebar(\n            ui.panel_sidebar(\n                ui.input_radio_buttons(\n                    id=\"size\",\n                    label=\"Select Frame size (This will impact available options below)\",\n                    choices={\"S\": \"7 inch\", \"M\": \"8 inch\", \"L\": \"10 inch\"},\n                ),\n                ui.input_select(\n                    id=\"frame\",\n                    label=\"Select Frame type:\",\n                    choices={},\n                ),\n                ui.input_select(\n                    id=\"stack\",\n                    label=\"Select Stack type:\",\n                    choices={\n                        \"sbf403\": \"SpeedyBee F403\",\n                        \"sbf404\": \"SpeedyBee F404\",\n                        \"gif403\": \"Galychyna\",\n                        \"vyriy\": \"Vyriy Drone + Q656 ESC\",\n                        \"dmf722\": \"Diatone mamba F722\",\n                    },\n                ),\n                ui.input_select(\n                    id=\"motor\",\n                    label=\"Select Motors type:\",\n                    choices={},\n                ),\n                ui.input_select(\n                    id=\"vtx\",\n                    label=\"Select VTX type:\",\n                    choices={\n                        \"fre72\": \"Foxeer Reaper Extreme V2 2.5W 72CH 5.8G\",\n                        \"fre40\": \"Foxeer Reaper Extreme 2.5W 40CH 5.8G\",\n                        \"fri40\": \"Foxeer Reaper Infinity 5W 40CH 5.8G\",\n                        \"rms48\": \"RushFPV MaxSolo 2.5W 48CH 5.8G\",\n                        \"rts48\": \"RushFPV TankSolo 1.6W 48CH 5.8G\",\n                        \"lts48\": \"ReadyToSky(LTS) 3W 48CH 5.8G\",\n                        \"afd40\": \"AKK FX2 Dominator 2W 40CH 5.8G\",\n                        \"aul40\": \"AKK Ultra Long Range 3W 40CH 5.8G\",\n                        \"gmp72\": \"GEPRC Maten Pro V2 2.5W V2 72CH 5.8G\",\n                        \"gmp40\": \"GEPRC Maten Pro 2.5W 40CH 5.8G\",\n                        \"blw40\": \"BLITZ Whoop 2.5W 40CH 5.8G\",\n                    },\n                ),\n            ),\n            ui.p(\"Advanced settings:\"),\n            ui.input_checkbox(id=\"set_pids\", label=\"Set PIDs?\"),\n            ui.input_checkbox(id=\"set_biper\", label=\"Set biper on failsafe?\"),\n            ui.input_checkbox(id=\"set_filters\", label=\"Set Filters?\"),\n            ui.input_checkbox(id=\"set_osd\", label=\"Set OSD?\"),\n            ui.input_checkbox(id=\"enable_servo\", label=\"Enable Servo?\"),\n            ui.input_select(\n                id=\"servo_motor_pad\",\n                label=\"Set Servo Pad:\",\n                choices={\"S9\": \"S9\", \"M8\": \"M8\", \"M5\": \"M5\"},\n            ),\n            ui.input_checkbox(id=\"set_vtx_power\", label=\"Set VTX Power on switch?\"),\n            ui.input_checkbox(id=\"enable_pit_mode\", label=\"Enable PIT mode?\"),\n            ui.input_select(\n                id=\"rx_uart\",\n                label=\"Set RX UART:\",\n                choices={\"2\": \"UART 2\", \"6\": \"UART 6\"},\n            ),\n        ),\n    ),\n    ui.card(\n        ui.card_header(\"Selection\"),\n        ui.download_button(\"download_file\", \"Download Selected Properties\"),\n        ui.input_action_button(\"action_button\", \"Show/Hide Configuration\"),\n        ui.output_text_verbatim(\"configuration\"),\n    ),\n)\n\n\ndef server(input, output, session):\n    \"\"\"Shiny server function for connecting user input with backend logic\"\"\"\n\n    @reactive.effect\n    def _():\n        ui.update_select(\"motor\", choices=MOTOR_CHOICES[input.size()])\n        ui.update_select(\"frame\", choices=FRAME_CHOICES[input.size()])\n\n    @output\n    @render.download(\n        filename=lambda: f\"betaflight-configuration-{date.today().isoformat()}.txt\"\n    )\n\n    # todo: implement more robust data handling\n    async def download_file():\n        await asyncio.sleep(0.25)\n        yield \"Results:\"\n        yield f\"Frame: {input.frame()}\\n\"\n        yield f\"Size: {input.size()}\\n\"\n        yield f\"Motors: {input.motor()}\\n\"\n        yield f\"Stack: {input.stack()}\\n\"\n        yield f\"VTX - {input.vtx()}\\n\"\n        yield \"Advanced configuration:\\n\"\n        yield f\"Set filters - {input.set_filters()}\\n\"\n        yield f\"Set pids - {input.set_pids()}\\n\"\n        yield f\"Set beeper - {input.set_biper()}\\n\"\n        yield f\"Set OSD settings - {input.set_osd()}\\n\"\n        yield f\"Enable Servo motor - {input.enable_servo()}\\n\"\n        if input.enable_servo() != \"False\":\n            yield f\"Servo motor pad - {input.servo_motor_pad()}\\n\"\n        yield f\"Set VTX power on switch - {input.set_vtx_power()}\\n\"\n        yield f\"Set VTX pit mode before arm - {input.enable_pit_mode()}\\n\"\n\n    @output\n    @render.text()\n    @reactive.event(input.action_button)\n    def configuration():\n        # Show/Hide text based on amount of clicks\n        if input.action_button() % 2 == 1:\n            return backend.parse_input(input)\n        return \"\"\n\n\n# app entry point\napp = App(ui=app_ui, server=server)\n", "type": "text"}, {"name": "backend.py", "content": "\"\"\"Backend module with all additional functions needed to support configurator app.\"\"\"\n\nimport json\nfrom pathlib import Path\n\nwith open(Path(__file__).parent / \"part_mapping.json\", \"r\", encoding=\"utf-8\") as f:\n    part_mapping = json.load(f)\n\n\ndef read_file(filename):\n    \"\"\"Function for reading configuration files\"\"\"\n    with open(filename, encoding=\"utf-8\") as config:\n        print(\"Open file with name: \", filename)\n        return config.read()\n\n\ndef parse_input(user_input):\n    \"\"\"Function for parsing user input from UI\n    user_input containse user settings selected on frontend\"\"\"\n    filepath = (\n        Path(__file__).parent / \"betaflight\" / part_mapping[\"VTX\"][user_input.vtx()]\n    )\n    return read_file(filepath)\n", "type": "text"}, {"name": "part_mapping.json", "content": "{\n    \"VTX\": {\n        \"fre72\": \"presets/vtx/foxeer/reaper_extreme_v2.txt\",\n        \"fre40\": \"presets/vtx/foxeer/reaper_extreme_v1.txt\",\n        \"fri40\": \"presets/vtx/foxeer/reaper_infinity.txt\",\n        \"rms48\": \"presets/vtx/rushfpv/max_solo.txt\",\n        \"rts48\": \"presets/vtx/rushfpv/tank_solo.txt\",\n        \"lts48\": \"presets/vtx/readytosky/lts.txt\",\n        \"afd40\": \"presets/vtx/akk/fx2_dominator.txt\",\n        \"aul40\": \"presets/vtx/akk/ultra_long_range.txt\",\n        \"gmp72\": \"presets/vtx/geprc/maten_pro_v2.txt\",\n        \"gmp40\": \"presets/vtx/geprc/maten_pro_v1.txt\",\n        \"blw40\": \"presets/vtx/blitz/whoop.txt\"\n    }\n}", "type": "text"}, {"name": "requirements-dev.txt", "content": "shiny\nshinylive", "type": "text"}, {"name": "betaflight/presets/vtx/README.md", "content": "# \u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u043e\u0432\u0430\u043d\u0456 \u0432\u0456\u0434\u0435\u043e\u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0447\u0456\n\n:warning: \u0412\u0456\u0434\u0435\u043e\u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0447 \u0410\u041a\u041a \u043d\u0435 \u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u044e\u0442\u044c \u0441\u0442\u0430\u0432\u0438\u0442\u0438 \u043d\u0430 \u0434\u0440\u043e\u043d\u0438 \u0447\u0435\u0440\u0435\u0437 \u0432\u0435\u043b\u0438\u043a\u0438\u0439 \u0432\u0456\u0434\u0441\u043e\u0442\u043e\u043a \u0431\u0440\u0430\u043a\u0443, \u0437\u0430\u0431\u0438\u0432\u0430\u043d\u043d\u044f \u0447\u0443\u0436\u0438\u0445 \u043a\u0430\u043d\u0430\u043b\u0456\u0432, \u0442\u0430 \u043f\u0435\u0440\u0435\u0433\u0440\u0456\u0432 \u0441\u0430\u043c\u043e\u0433\u043e \u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0447\u0430. \u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u0442\u0456\u043b\u044c\u043a\u0438 \u044f\u043a\u0449\u043e \u0432\u0436\u0435 \u0454 \u0432 \u043d\u0430\u044f\u0432\u043d\u043e\u0441\u0442\u0456 \u0456 \u043f\u0456\u0434\u0440\u043e\u0437\u0434\u0456\u043b \u043d\u0435 \u043f\u0440\u043e\u0442\u0438 \u0442\u0430\u043a\u043e\u0433\u043e \u0434\u0440\u043e\u043d\u0430.\n\n:warning: \u0412\u0456\u0434\u0435\u043e\u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0447 RushFpv Tank Solo \u043d\u0430 1.6\u0412\u0442 \u0431\u0440\u0430\u0442\u0438 \u0442\u0456\u043b\u044c\u043a\u0438 \u0434\u043b\u044f \u043d\u0430\u0432\u0447\u0430\u043b\u044c\u043d\u0438\u0445 \u0434\u0440\u043e\u043d\u0456\u0432 \u0430\u0431\u043e \u0443 \u0432\u0438\u043f\u0430\u0434\u043a\u0443 \u043a\u043e\u043b\u0438 \u043d\u0456\u0447\u043e\u0433\u043e \u0456\u043d\u0448\u043e\u0433\u043e \u043d\u0435\u043c\u0430 \u0432 \u043d\u0430\u044f\u0432\u043d\u043e\u0441\u0442\u0456\n", "type": "text"}, {"name": "betaflight/presets/vtx/blitz/whoop.txt", "content": "### BLITZ Whoop 2.5W 40CH 5.8G IRC Tramp ###\nvtxtable bands 5\nvtxtable channels 8\nvtxtable band 1 BOSCAM_A A FACTORY 5865 5845 5825 5805 5785 5765 5745 5725\nvtxtable band 2 BOSCAM_B B FACTORY 5733 5752 5771 5790 5809 5828 5847 5866\nvtxtable band 3 BOSCAM_E E FACTORY 5705 5685 5665 5645 5885 5905 5925 5945\nvtxtable band 4 FATSHARK F FACTORY 5740 5760 5780 5800 5820 5840 5860 5880\nvtxtable band 5 RACEBAND R FACTORY 5658 5695 5732 5769 5806 5843 5880 5917", "type": "text"}, {"name": "betaflight/presets/vtx/akk/fx2_dominator.txt", "content": "### AKK FX2 Dominator 2W 40CH 5.8G SmartAudio ###\nvtxtable bands 5\nvtxtable channels 8\nvtxtable band 1 BOSCAM_A A FACTORY 5865 5845 5825 5805 5785 5765 5745 5725\nvtxtable band 2 BOSCAM_B B FACTORY 5733 5752 5771 5790 5809 5828 5847 5866\nvtxtable band 3 BOSCAM_E E FACTORY 5705 5685 5665 0 5885 5905 0 0\nvtxtable band 4 FATSHARK F FACTORY 5740 5760 5780 5800 5820 5840 5860 5880\nvtxtable band 5 RACEBAND R FACTORY 5658 5695 5732 5769 5806 5843 5880 5917\nvtxtable powerlevels 4\nvtxtable powervalues 0 1 2 3\nvtxtable powerlabels 250 500 1000 2000", "type": "text"}, {"name": "betaflight/presets/vtx/akk/ultra_long_range.txt", "content": "### AKK Ultra Long Range 3W 40CH 5.8G SmartAudio ###\nvtxtable bands 5\nvtxtable channels 8\nvtxtable band 1 BOSCAM_A A FACTORY 5865 5845 5825 5805 5785 5765 5745 5725\nvtxtable band 2 BOSCAM_B B FACTORY 5733 5752 5771 5790 5809 5828 5847 5866\nvtxtable band 3 BOSCAM_E E FACTORY 5705 5685 5665 0 5885 5905 0 0\nvtxtable band 4 FATSHARK F FACTORY 5740 5760 5780 5800 5820 5840 5860 5880\nvtxtable band 5 RACEBAND R FACTORY 5658 5695 5732 5769 5806 5843 5880 5917\nvtxtable powerlevels 5\nvtxtable powervalues 0 1 2 3 4\nvtxtable powerlabels 250 500 1000 2000 3000", "type": "text"}, {"name": "betaflight/presets/vtx/geprc/maten_pro_v1.txt", "content": "### GEPRC Maten Pro 2.5W 40CH 5.8G IRC Tramp ###\nvtxtable bands 5\nvtxtable channels 8\nvtxtable band 1 BOSCAM_A A FACTORY 5865 5845 5825 5805 5785 5765 5745 5725\nvtxtable band 2 BOSCAM_B B FACTORY 5733 5752 5771 5790 5809 5828 5847 5866\nvtxtable band 3 BOSCAM_E E FACTORY 5705 5685 5665 5645 5885 5905 5925 5945\nvtxtable band 4 FATSHARK F FACTORY 5740 5760 5780 5800 5820 5840 5860 5880\nvtxtable band 5 RACEBAND R FACTORY 5658 5695 5732 5769 5806 5843 5880 5917", "type": "text"}, {"name": "betaflight/presets/vtx/geprc/maten_pro_v2.txt", "content": "### GEPRC Maten Pro V2 2.5W 72CH 5.8G IRC Tramp ###\nvtxtable bands 8\nvtxtable channels 8\nvtxtable band 1 BAND_A   A FACTORY  5865 5845 5825 5805 5785 5765 5745 5725\nvtxtable band 2 BAND_B   B FACTORY  5733 5752 5771 5790 5809 5828 5847 5866\nvtxtable band 3 BAND_E   E FACTORY  5705 5685 5665 5645 5885 5905 5925 5945\nvtxtable band 4 BAND_F   F FACTORY  5740 5760 5780 5800 5820 5840 5860 5880\nvtxtable band 5 BAND_R   R FACTORY  5658 5695 5732 5769 5806 5843 5880 5917\nvtxtable band 6 BAND_H     FACTORY  5653 5693 5733 5773 5813 5853 5893 5933\nvtxtable band 7 BAND_L     FACTORY  5333 5373 5413 5453 5493 5533 5573 5613\nvtxtable band 8 BAND_U     FACTORY  5325 5348 5366 5384 5402 5420 5438 5456\nvtxtable powerlevels 5", "type": "text"}, {"name": "betaflight/presets/vtx/rushfpv/max_solo.txt", "content": "### Rush Max Solo 2.5W 48CH 5.8G SmartAudio ###\n# vtxtable\nvtxtable bands 6\nvtxtable channels 8\nvtxtable band 1 BAND_A   A CUSTOM  5865 5845 5825 5805 5785 5765 5745 5725\nvtxtable band 2 BAND_B   B CUSTOM  5733 5752 5771 5790 5999 5828 5847 5866\nvtxtable band 3 BAND_E   E CUSTOM  5705 5685 5665 5645 5885 5905 5925 5945\nvtxtable band 4 AIRWAVE  F CUSTOM  5740 5760 5780 5800 5820 5840 5860 5880\nvtxtable band 5 RACEBAND R CUSTOM  5658 5695 5732 5769 5806 5843 5880 5917\nvtxtable band 6 LOWRACE  L CUSTOM  5362 5399 5436 5473 5510 5547 5584 5621\nvtxtable powerlevels 4\nvtxtable powervalues 14 27 30 34\nvtxtable powerlabels 25 500 1 2.5", "type": "text"}, {"name": "betaflight/presets/vtx/rushfpv/tank_solo.txt", "content": "### Rush Tank Solo 1.6W 48CH 5.8G SmartAudio ###\n# vtxtable\nvtxtable bands 6\nvtxtable channels 8\nvtxtable band 1 BAND_A   A CUSTOM  5865 5845 5825 5805 5785 5765 5745 5725\nvtxtable band 2 BAND_B   B CUSTOM  5733 5752 5771 5790 5999 5828 5847 5866\nvtxtable band 3 BAND_E   E CUSTOM  5705 5685 5665 5645 5885 5905 5925 5945\nvtxtable band 4 AIRWAVE  F CUSTOM  5740 5760 5780 5800 5820 5840 5860 5880\nvtxtable band 5 RACEBAND R CUSTOM  5658 5695 5732 5769 5806 5843 5880 5917\nvtxtable band 6 LOWRACE  L CUSTOM  5362 5399 5436 5473 5510 5547 5584 5621\nvtxtable powerlevels 4\nvtxtable powervalues 14 26 29 32\nvtxtable powerlabels 25 400 800 MAX", "type": "text"}, {"name": "betaflight/presets/vtx/foxeer/reaper_extreme_v1.txt", "content": "### Reaper Extreme V2 2.5W 40CH 5.8G IRC Tramp ###\n# vtxtable\nvtxtable bands 5\nvtxtable channels 8\nvtxtable band 1 BOSCAM_A A CUSTOM  5865 5845 5825 5805 5785 5765 5745 5725\nvtxtable band 2 BOSCAM_B B CUSTOM  5733 5752 5771 5790 5809 5828 5847 5866\nvtxtable band 3 BOSCAM_E E CUSTOM  5705 5685 5665 5645 5885 5905 5925 5945\nvtxtable band 4 FATSHARK F CUSTOM  5740 5760 5780 5800 5820 5840 5860 5880\nvtxtable band 5 RACEBAND R CUSTOM  5658 5695 5732 5769 5806 5843 5880 5917\nvtxtable powerlevels 5\nvtxtable powervalues 25 100 200 400 600\nvtxtable powerlabels 25 200 500 1.5 2.5", "type": "text"}, {"name": "betaflight/presets/vtx/foxeer/reaper_extreme_v2.txt", "content": "### Reaper Extreme V2 2.5W 72CH 5.8G IRC Tramp ###\n# vtxtable\nvtxtable bands 8\nvtxtable channels 8\nvtxtable band 1 BAND_A   A CUSTOM  5865 5845 5825 5805 5785 5765 5745 5725\nvtxtable band 2 BAND_B   B CUSTOM  5733 5752 5771 5790 5809 5828 5847 5866\nvtxtable band 3 BAND_E   E CUSTOM  5705 5685 5665 5645 5885 5905 5925 5945\nvtxtable band 4 BAND_F   F CUSTOM  5740 5760 5780 5800 5820 5840 5860 5880\nvtxtable band 5 BAND_R   R CUSTOM  5658 5695 5732 5769 5806 5843 5880 5917\nvtxtable band 6 BAND_H     CUSTOM  5653 5693 5733 5773 5813 5853 5893 5933\nvtxtable band 7 BAND_L     CUSTOM  5333 5373 5413 5453 5493 5533 5573 5613\nvtxtable band 8 BAND_U     CUSTOM  5325 5348 5366 5384 5402 5420 5438 5456\nvtxtable powerlevels 5\nvtxtable powervalues 25 100 200 400 600\nvtxtable powerlabels 25 200 500 1.5 2.5", "type": "text"}, {"name": "betaflight/presets/vtx/foxeer/reaper_infinity.txt", "content": "### Reaper Reaper Infinity 5W 40CH 5.8G IRC Tramp ###\n# vtxtable\nvtxtable bands 5\nvtxtable channels 8\nvtxtable band 1 BOSCAM_A A CUSTOM  5865 5845 5825 5805 5785 5765 5745 5725\nvtxtable band 2 BOSCAM_B B CUSTOM  5733 5752 5771 5790 5809 5828 5847 5866\nvtxtable band 3 BOSCAM_E E CUSTOM  5705 5685 5665 5645 5885 5905 5925 5945\nvtxtable band 4 FATSHARK F CUSTOM  5740 5760 5780 5800 5820 5840 5860 5880\nvtxtable band 5 RACEBAND R CUSTOM  5658 5695 5732 5769 5806 5843 5880 5917\nvtxtable powerlevels 5\nvtxtable powervalues 25 100 200 400 600\nvtxtable powerlabels 50 500 1W 2.5 5W", "type": "text"}, {"name": "betaflight/presets/vtx/readytosky/lts.txt", "content": "### Readytosky (LTS) 3W 48CH 5.8G IRC Tramp ###\n# vtxtable\nvtxtable bands 6\nvtxtable channels 8\nvtxtable band 1 BAND_A A CUSTOM  5865 5845 5825 5805 5785 5765 5745 5725\nvtxtable band 2 BAND_B B CUSTOM  5733 5752 5771 5790 5999 5828 5847 5866\nvtxtable band 3 BAND_E E CUSTOM  5705 5685 5665 5645 5885 5905 5925 5945\nvtxtable band 4 BAND_F F CUSTOM  5740 5760 5780 5800 5820 5840 5860 5880\nvtxtable band 5 BAND_R R CUSTOM  5658 5695 5732 5769 5806 5843 5880 5917\nvtxtable band 6 BAND_L L CUSTOM  5362 5399 5436 5473 5510 5547 5584 5621\nvtxtable powerlevels 4\nvtxtable powervalues 14 27 30 34\nvtxtable powerlabels 25 1W 2W 3W", "type": "text"}]
